/**
 * Dense - Device pixel ratio aware images
 *
 * @link    http://dense.rah.pw
 * @license MIT
 */
!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):e(window.jQuery||window.Zepto)}(function($){"use strict";var e=[],n={},i=/^([a-z]:)?\/\//i,t=/\.\w+$/,d;n.init=function(s){return s=$.extend({ping:null,dimensions:"preserve",glue:"_",skipExtensions:["svg"]},s),this.each(function(){var o=$(this);if(o.is("img")&&!o.hasClass("dense-image")){o.addClass("dense-image dense-loading");var a=n.getImageAttribute.call(this),r=o.attr("src"),u=!1,c;if(!a){if(!r||1===d||-1!==$.inArray(r.split(".").pop().split(/[\?\#]/).shift(),s.skipExtensions))return void o.removeClass("dense-image dense-loading");a=r.replace(t,function(e){return s.glue+d+"x"+e}),u=s.ping!==!1&&-1===$.inArray(a,e)&&(s.ping===!0||!i.test(a)||0===a.indexOf("//"+document.domain)||0===a.indexOf(document.location.protocol+"//"+document.domain))}c=function(){var e=function(){o.removeClass("dense-loading").addClass("dense-ready").trigger("denseRetinaReady.dense")};o.attr("src",a),"update"===s.dimensions?o.dense("updateDimensions").one("denseDimensionChanged",e):("remove"===s.dimensions&&o.removeAttr("width height"),e())},u?$.ajax({url:a,type:"HEAD"}).done(function(n,i,t){var d=t.getResponseHeader("Content-type");d&&0!==d.indexOf("image/")||(e.push(a),c())}):c()}}),this},n.updateDimensions=function(){return this.each(function(){var e,n=$(this),i=n.attr("src");i&&(e=new Image,e.src=i,$(e).on("load.dense",function(){n.attr({width:e.width,height:e.height}).trigger("denseDimensionChanged.dense")}))})},n.devicePixelRatio=function(){var e=1;return"undefined"!==$.type(window.devicePixelRatio)?e=window.devicePixelRatio:"undefined"!==$.type(window.matchMedia)&&$.each([1.3,2,3,4,5,6],function(n,i){var t=["(-webkit-min-device-pixel-ratio: "+i+")","(min-resolution: "+Math.floor(96*i)+"dpi)","(min-resolution: "+i+"dppx)"].join(",");return window.matchMedia(t).matches?void(e=i):!1}),Math.ceil(e)},n.getImageAttribute=function(){for(var e=$(this).eq(0),n=!1,i,t=1;d>=t;t++)i=e.attr("data-"+t+"x"),i&&(n=i);return n},d=n.devicePixelRatio(),$.fn.dense=function(e,i){return"string"===$.type(e)&&"function"===$.type(n[e])||(i=e,e="init"),n[e].call(this,i)},$(function(){$("body.dense-retina img").dense()})});